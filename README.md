# Компонент веб-формы в модальном окне (ceh9:webform)

Компонент позволяет выводить веб-форму Bitrix в модальном окне (popup). Реализован с использованием стандартного модуля "Веб-формы" и библиотеки `BX.PopupWindow`. Поддерживает валидацию полей, отправку через AJAX и маску для ввода телефона.

## Требования

- 1С-Битрикс: Управление сайтом (редакция с модулем "Веб-формы").
- Модуль `form` (Веб-формы).

## Установка

1. Скопируйте папку с компонентом в директорию `/local/components/ceh9/webform/` (или `/bitrix/components/ceh9/webform/`).
2. Убедитесь, что в системе создана веб-форма, которую вы хотите выводить.

## Подключение

Вызов компонента в шаблоне сайта или на странице:

```php
$APPLICATION->IncludeComponent(
    "ceh9:webform",
    "modal",
    [
        "WEB_FORM_ID" => "1", // ID веб-формы
        "FORM_TITLE" => "Заполните анкету", // Заголовок формы в модальном окне
        "BUTTON_TEXT" => "Открыть форму", // Текст кнопки вызова
        "SUCCESS_MESSAGE" => "Спасибо! Ваша заявка принята.", // Сообщение об успехе
        "AGREEMENT_TEXT" => "Я согласен на обработку персональных данных", // Текст соглашения
        "PHONE_FIELD_SID" => "PHONE", // Символьный код поля телефона для маски (необязательно)
        "PHONE_FIELD_MASK" => "+375 (99) 999-99-99", // Маска для ввода телефона
        "CACHE_TIME" => "3600",
        "CACHE_TYPE" => "A",
    ]
);
```

## Параметры компонента

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `WEB_FORM_ID` | ID веб-формы (обязательно). | - |
| `FORM_TITLE` | Заголовок формы внутри модального окна. Поддерживает макрос `#FORM_ID#`. | Заголовок из настроек формы или дефолтный |
| `BUTTON_TEXT` | Текст на кнопке, открывающей модальное окно. | Значение из языкового файла |
| `SUCCESS_MESSAGE` | Сообщение, которое показывается после успешной отправки формы. | Значение из языкового файла |
| `AGREEMENT_TEXT` | Текст рядом с галочкой согласия на обработку данных. | Значение из языкового файла |
| `PHONE_FIELD_SID` | Символьный идентификатор (SID) поля типа "text", к которому нужно применить маску телефона. | - |
| `PHONE_FIELD_MASK` | Маска для ввода телефона (используется формат библиотеки masked_input). | +375 (99) 999-99-99 |
| `CACHE_TIME` | Время кеширования (сек). | 3600 |

## Особенности работы

- **AJAX**: Отправка формы происходит без перезагрузки страницы через `BX.ajax.runComponentAction`.
- **Валидация**:
    - Клиентская валидация HTML5 (required).
    - Кастомная JS-валидация перед отправкой.
    - Серверная валидация через модуль веб-форм.
- **Маска телефона**: Если указан `PHONE_FIELD_SID`, к полю применяется маска (по умолчанию `+375 (99) 999-99-99`, настраивается в `PHONE_FIELD_MASK`).
- **Файлы**: Поддерживается загрузка файлов через AJAX.

## Кастомизация и шаблоны

Компонент содержит два шаблона:
1. **.default** (по умолчанию) — выводит форму на странице.
2. **modal** — выводит кнопку, по клику на которую открывается модальное окно с формой.

Шаблоны находятся в папке `templates/`.
- `templates/.default/`:
    - `template.php`: Разметка формы.
    - `script.php`: Логика отправки формы (AJAX).
    - `mask.php`: Логика инициализации маски телефона.
    - `style.css`: Стили формы.
- `templates/modal/`:
    - `template.php`: Кнопка вызова.
    - `script.php`: Логика модального окна, формы и маски.
    - `style.css`: Стили модального окна и формы.